{% extends 'base_page.html' %}

{% block body %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6">

            {% if form_type == 'login' %}
            <!-- Login Form -->
            <form method="post" class="bg-white p-4 rounded shadow">
                <h4 class="text-center mb-3">Login</h4>
                {{ login_form.hidden_tag() }}
                <div class="mb-3">
                    {{ login_form.email(class_="form-control", placeholder="Email") }}
                </div>
                <div class="mb-3">
                    {{ login_form.password(class_="form-control", placeholder="Password") }}
                </div>
                <div class="d-grid">
                    {{ login_form.submit(class_="btn btn-primary") }}
                </div>
            </form>

            {% elif form_type == 'signup' %}
            <!-- Signup Form -->
            <form method="POST" class="bg-white p-4 p-md-5 rounded shadow-sm mx-auto mt-4" style="max-width: 500px;" id="signup_form">
                <h3 class="text-center mb-4">Create Account</h3>

                <p class="text-center text-muted">
                    Already have an account? <a href="{{ url_for('profile', form_type='login') }}" class="text-decoration-none">Login</a>
                </p>

                {{ signup_form.hidden_tag() }}

                <div class="mb-3">
                    {{ signup_form.fullname(class_="form-control", placeholder="Full Name") }}
                </div>
                <div class="mb-3">
                    {{ signup_form.email(class_="form-control", placeholder="Email Address") }}
                </div>
                <div class="mb-3">
                    {{ signup_form.phone(class_="form-control", placeholder="Phone Number", id="phone")}}

                    {% if signup_form.phone.errors %}
                    <div class="text-danger small mt-1">{{ signup_form.phone.errors[0] }}</div>
                    {% endif %} 
                </div>
                <div class="mb-3">
                    {{ signup_form.password(class_="form-control", placeholder="Password") }}
                </div>

                <div class="d-grid">
                    {{ signup_form.submit(class_="btn btn-primary") }}
                </div>
            </form>
            {% endif %}
        </div>
    </div>
</div>

<!-- Scripts for intl-tel-input -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"></script>

<script>
    const phone = document.querySelector("#phone");
    const iti = window.intlTelInput(phone, {
        preferredCountries: ["in", "us", "gb"],
        separateDialCode: true,
        initialCountry: "in",
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js"
    });

    document.querySelector("#signup_form").addEventListener("submit", function (e) {
        phone.value = iti.getNumber(); // E.164 format
    });
</script>
{% endblock body %}

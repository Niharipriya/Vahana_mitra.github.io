{% extends 'base_page.html' %}

{% block body %}
<div class="container mt-5">
    <h2 class="text-center">Welcome, {{ current_user.fullname }}</h2>
    <p class="text-center text-muted">Email: {{ current_user.email }}</p>

    <div class="text-center mb-4">
        <a class="btn btn-outline-primary me-2" href="#">Register Truck</a>
        <a class="btn btn-outline-success" href="#">Schedule Material</a>
    </div>

    <div class="row justify-content-center mb-5">
        <div class="col-md-6">
            {% if adding_type == 'truck' %}
            <form method="post" class="bg-white p-4 rounded shadow">
                <h4 class="text-center mb-3">Register Your Truck</h4>
                {{ truck_form.hidden_tag() }}
                
                <div class="mb-3">
                    {{ truck_form.registration_number(class_="form-control", placeholder="XX88 XY8888") }}
                </div>
                <div class="form-check mb-3">
                    {{ truck_form.available_date(class_="form-check-input", id="availability") }}
                    <label class="form-check-label" for="availability">Currently Available</label>
                </div>
                <div class="d-grid">
                    {{ truck_form.submit(class_="btn btn-primary") }}
                </div>
            </form>

            {% elif adding_type == 'material' %}
            <form method="post" class="bg-white p-4 rounded shadow">
                <h4 class="text-center mb-3">Schedule Your Material</h4>
                {{ material_form.hidden_tag() }}
                
                <div class="mb-3">
                    {{ material_form.pickup_location(class_="form-control", placeholder="Pickup Address", id="pickup") }}
                </div>
                <div class="mb-3">
                    {{ material_form.drop_location(class_="form-control", placeholder="Dropoff Address", id="drop") }}
                </div>
                <div class="d-grid">
                    {{ material_form.submit(class_="btn btn-success") }}
                </div>
            </form>
            {% endif %}
        </div>
    </div>

    <h4 class="mb-3">Your Booked Loads</h4>
<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Pickup Location</th>
            <th>Drop Location</th>
            <th>Pickup Date & Time</th>
            <th>Drop Date & Time</th>
            <th>Load Type</th>
            <th>Weight (tons)</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for load in loads %}
        <tr>
            <td>{{ load.pickup_location }}</td>
            <td>{{ load.drop_location }}</td>
            <td>{{ load.pickup_datetime.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ load.drop_datetime.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ load.load_type }}</td>
            <td>{{ load.load_weight }}</td>
            <td>
                {% if load.in_progress %}
                    <span class="badge bg-warning">In Progress</span>
                {% elif load.is_active %}
                    <span class="badge bg-success">Active</span>
                {% else %}
                    <span class="badge bg-secondary">Inactive</span>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" class="text-center text-muted">No loads scheduled yet.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<script>
  // Google Places Autocomplete (if needed in future)
  // function initAutocomplete() {
  //   new google.maps.places.Autocomplete(document.getElementById('pickup'), { types: ['geocode'] });
  //   new google.maps.places.Autocomplete(document.getElementById('drop'), { types: ['geocode'] });
  // }
  // google.maps.event.addDomListener(window, 'load', initAutocomplete);
</script>
{% endblock %}

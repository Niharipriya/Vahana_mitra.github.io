{% extends 'base_page.html' %}

{% block body %}
<div class="container mt-5">
    <h2 class="text-center">Welcome, {{ current_user.fullname }}</h2>
    <p class="text-center text-muted">Email: {{ current_user.email }}</p>

    <div class="text-center mb-4">
        <button id="lorrybutton" class="btn btn-outline-primary btn-lg mt-4" onclick="showSection('lorry')">ðŸšš Truck</button>
        <button id="materialbutton" class="btn btn-outline-success btn-lg mt-4 ms-2" onclick="showSection('material')">ðŸ“¦ Material</button>
    </div>

    <div id="lorry-section" style="display: none;">
    <h4 class="mb-3">Your Booked Loads</h4>
<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Pickup Location</th>
            <th>Drop Location</th>
            <th>Pickup Date & Time</th>
            <th>Drop Date & Time</th>
            <th>Load Type</th>
            <th>Weight (tons)</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for load in loads %}
        <tr>
            <td>{{ load.pickup_location }}</td>
            <td>{{ load.drop_location }}</td>
            <td>{{ load.pickup_datetime.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ load.drop_datetime.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ load.load_type }}</td>
            <td>{{ load.load_weight }}</td>
            <td>
                {% if load.in_progress %}
                    <span class="badge bg-warning">In Progress</span>
                {% elif load.is_active %}
                    <span class="badge bg-success">Active</span>
                {% else %}
                    <span class="badge bg-secondary">Inactive</span>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" class="text-center text-muted">No loads scheduled yet.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
<div id="material-section" style="display: none;">
<h4 class="mb-3">Your Registered Trucks</h4>
<table class="table table-striped table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Vehicle Number</th>
            <th>Model Name</th>
            <th>Type</th>
            <th>Capacity (tons)</th>
            <th>Current Location</th>
            <th>Available</th>
            <th>Verified</th>
        </tr>
    </thead>
    <tbody>
        {% for truck in trucks %}
        <tr>
            <td>{{ truck.vehicle_registration_number }}</td>
            <td>{{ truck.vehicle_model_name }}</td>
            <td>{{ truck.vehicle_type }}</td>
            <td>{{ truck.vehicle_capacity }}</td>
            <td>{{ truck.current_location }}</td>
            <td>
                {% if truck.is_available %}
                <input type="checkbox" class="form-check-input" checked disabled>
                {% else %}
                <input type="checkbox" class="form-check-input" disabled>
                {% endif %}
            </td>
            <td>
                {% if truck.is_verified %}
                <span class="badge bg-success">Yes</span>
                {% else %}
                <span class="badge bg-secondary">No</span>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" class="text-center text-muted">No trucks registered.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
</div>

<script>
  // Google Places Autocomplete (if needed in future)
  // function initAutocomplete() {
  //   new google.maps.places.Autocomplete(document.getElementById('pickup'), { types: ['geocode'] });
  //   new google.maps.places.Autocomplete(document.getElementById('drop'), { types: ['geocode'] });
  // }
  // google.maps.event.addDomListener(window, 'load', initAutocomplete);

function showSection(section) {
    const lorrySection = document.getElementById('lorry-section');
    const materialSection = document.getElementById('material-section');

    if (section === 'lorry') {
        lorrySection.style.display = 'block';
        materialSection.style.display = 'none';
    } else if (section === 'material') {
        lorrySection.style.display = 'none';
        materialSection.style.display = 'block';
    }
}

// Show one section by default on page load
window.onload = function () {
    showSection('lorry');  // Or use 'material' if you prefer that by default
};
</script>
{% endblock %}
